<?xml version="1.0"?>
<importer xmlns="http://wedge.org/xml/importer" xmlns:smf="http://wedge.org/">
	<general>
		<name>SMF 2.0</name>
		<version>Wedge 0.1</version>
		<settings>/Settings.php</settings>
		<from_prefix>`$db_name`.$db_prefix</from_prefix>
		<table_test>{$from_prefix}members;</table_test>
		<defines>SMF=1</defines>
	</general>
	<step type="mandatory">
		<title>Importing members</title>
		<detect>{$from_prefix}members</detect>
		<destination>{$to_prefix}members</destination>
		<presql>TRUNCATE {$to_prefix}members;</presql>
		<query>
				SELECT
					id_member, member_name, date_registered, posts, id_group, lngfile, last_login,
					real_name, instant_messages, unread_messages, new_pm, buddy_list, pm_ignore_list,
					pm_prefs, mod_prefs, message_labels, passwd, openid_uri, email_address, personal_text,
					gender, birthdate, website_url, website_title, location, hide_email, show_online,
					time_format, signature, time_offset, avatar, pm_email_notify,
					usertitle, notify_announcements, notify_regularity, notify_send_body,
					notify_types, member_ip, member_ip2, secret_question, secret_answer, id_theme, is_activated,
					validation_code, id_msg_last_visit, additional_groups, smiley_set, id_post_group,
					total_time_logged_in, password_salt, ignore_boards, warning, passwd_flood,
					pm_receive_from
				FROM {$from_prefix}members;
		</query>
	</step>
	<step>
		<title>Importing categories</title>
		<detect>{$from_prefix}categories</detect>
		<destination>{$to_prefix}categories</destination>
		<presql>TRUNCATE {$to_prefix}categories;</presql>
		<query>
				SELECT
					id_cat, name, cat_order, can_collapse
				FROM {$from_prefix}categories;
		</query>
	</step>
	<step>
		<title>Importing collapsed categories</title>
		<detect>{$from_prefix}collapsed_categories</detect>
		<destination>{$to_prefix}collapsed_categories</destination>
		<presql>TRUNCATE {$to_prefix}collapsed_categories;</presql>
		<query>
				SELECT
					id_cat, id_member
				FROM {$from_prefix}collapsed_categories;
		</query>
	</step>
	<step>
		<title>Importing boards</title>
		<detect>{$from_prefix}boards</detect>
		<destination>{$to_prefix}boards</destination>
		<presql>TRUNCATE {$to_prefix}boards;</presql>
		<preparsecode>
			$row['url'] = $this->boardurl . '/board' . $row['url'];

			if (!empty($row['member_groups']))
			{
				$permissions = explode(',', $row['member_groups']);
				foreach ($permissions as $allowed)
					$db->query("
						REPLACE INTO {$to_prefix}board_groups
							(id_group, id_board, view_perm, enter_perm)
						VALUES ($allowed, $row[id_board], 'allow', 'allow')
					");
			}
		</preparsecode>
		<query>
				SELECT
					id_board,id_cat,child_level,id_parent,board_order,id_last_msg,id_msg_updated,member_groups,
					id_profile,name,description,num_topics,num_posts,count_posts,id_theme,
					override_theme,unapproved_posts,unapproved_topics,redirect, id_board AS url
				FROM {$from_prefix}boards;
		</query>
	</step>
	<step>
		<title>Importing topics</title>
		<detect>{$from_prefix}topics</detect>
		<destination>{$to_prefix}topics</destination>
		<presql>TRUNCATE {$to_prefix}topics;</presql>
		<query>
				SELECT
					id_topic,is_sticky,id_board,id_first_msg,id_last_msg,id_member_started,
					id_member_updated,id_poll,id_previous_board,id_previous_topic,num_replies,
					num_views,locked,unapproved_posts,approved
				FROM {$from_prefix}topics;
		</query>
	</step>
	<step>
		<title>Importing messages</title>
		<detect>{$from_prefix}messages</detect>
		<destination>{$to_prefix}messages</destination>
		<presql>TRUNCATE {$to_prefix}messages;</presql>
		<options>
			<limit>100</limit>
		</options>
		<query>
				SELECT
					id_msg, approved, id_topic, id_board, id_member, id_msg_modified, subject, poster_name,
					poster_email, poster_ip, smileys_enabled, modified_time, modified_name, body, icon
				FROM {$from_prefix}messages;
		</query>
	</step>
	<step>
		<title>Importing polls</title>
		<detect>{$from_prefix}polls</detect>
		<destination>{$to_prefix}polls</destination>
		<presql>TRUNCATE {$to_prefix}polls;</presql>
		<query>
				SELECT
					id_poll, question, voting_locked, max_votes, expire_time, hide_results, change_vote,
					guest_vote, num_guest_voters, reset_poll, id_member, poster_name
				FROM {$from_prefix}polls;
		</query>
	</step>
	<step>
		<title>Importing poll choices</title>
		<detect>{$from_prefix}poll_choices</detect>
		<destination>{$to_prefix}poll_choices</destination>
		<presql>TRUNCATE {$to_prefix}poll_choices;</presql>
		<query>
				SELECT
					id_poll, id_choice, label, votes
				FROM {$from_prefix}poll_choices;
		</query>
	</step>
	<step>
		<title>Importing poll votes</title>
		<detect>{$from_prefix}log_polls</detect>
		<destination>{$to_prefix}log_polls</destination>
		<presql>TRUNCATE {$to_prefix}log_polls;</presql>
		<query>
				SELECT
					id_poll, id_member, id_choice
				FROM {$from_prefix}log_polls;
		</query>
	</step>
	<step>
		<title>Importing personal messages</title>
		<detect>{$from_prefix}personal_messages</detect>
		<destination>{$to_prefix}personal_messages</destination>
		<presql>TRUNCATE {$to_prefix}personal_messages;</presql>
		<options>
			<limit>200</limit>
		</options>
		<query>
				SELECT
					id_pm, id_pm_head, id_member_from, deleted_by_sender, from_name,
					msgtime, subject, body
				FROM {$from_prefix}personal_messages;
		</query>
	</step>
	<step>
		<title>Importing pm recipients</title>
		<detect>{$from_prefix}pm_recipients</detect>
		<destination>{$to_prefix}pm_recipients</destination>
		<presql>TRUNCATE {$to_prefix}pm_recipients;</presql>
		<query>
				SELECT
					id_pm, id_member, labels, bcc, is_read, is_new, deleted
				FROM {$from_prefix}pm_recipients;
		</query>
	</step>
	<step>
		<title>Importing pm rules</title>
		<detect>{$from_prefix}pm_rules</detect>
		<destination>{$to_prefix}pm_rules</destination>
		<presql>TRUNCATE {$to_prefix}pm_rules;</presql>
		<query>
				SELECT
					id_rule, id_member, rule_name, criteria, actions, delete_pm, is_or
				FROM {$from_prefix}pm_rules;
		</query>
	</step>
	<step>
		<title>Importing board moderators</title>
		<detect>{$from_prefix}moderators</detect>
		<destination>{$to_prefix}moderators</destination>
		<presql>TRUNCATE {$to_prefix}moderators;</presql>
		<query>
				SELECT
					id_board, id_member
				FROM {$from_prefix}moderators;
		</query>
	</step>
	<step>
		<title>Importing mark read data (boards)</title>
		<detect>{$from_prefix}log_boards</detect>
		<destination>{$to_prefix}log_boards</destination>
		<presql>TRUNCATE {$to_prefix}log_boards;</presql>
		<query>
				SELECT
					id_member, id_board, id_msg
				FROM {$from_prefix}log_boards;
		</query>
	</step>
	<step>
		<title>Importing mark read data (topics)</title>
		<detect>{$from_prefix}log_topics</detect>
		<destination>{$to_prefix}log_topics</destination>
		<presql>TRUNCATE {$to_prefix}log_topics;</presql>
		<query>
				SELECT
					id_member, id_topic, id_msg
				FROM {$from_prefix}log_topics;
		</query>
	</step>
	<step>
		<title>Importing notifications</title>
		<detect>{$from_prefix}log_notify</detect>
		<destination>{$to_prefix}log_notify</destination>
		<presql>TRUNCATE {$to_prefix}log_notify;</presql>
		<query>
				SELECT
					id_member, id_topic, id_board, sent
				FROM {$from_prefix}log_notify;
		</query>
	</step>
	<step>
		<title>Importing calendar</title>
		<detect>{$from_prefix}calendar</detect>
		<destination>{$to_prefix}calendar</destination>
		<presql>TRUNCATE {$to_prefix}calendar;</presql>
		<query>
				SELECT
					id_event, start_date, end_date, id_board, id_topic, title, id_member
				FROM {$from_prefix}calendar;
		</query>
	</step>
	<step>
		<title>Importing calendar holidays</title>
		<detect>{$from_prefix}calendar_holidays</detect>
		<destination>{$to_prefix}calendar_holidays</destination>
		<presql>TRUNCATE {$to_prefix}calendar_holidays;</presql>
		<query>
				SELECT
					id_holiday, event_date, title
				FROM {$from_prefix}calendar_holidays;
		</query>
	</step>
	<step>
		<title>Importing membergroups</title>
		<detect>{$from_prefix}membergroups</detect>
		<destination>{$to_prefix}membergroups</destination>
		<options>
			<replace>true</replace>
		</options>
		<query>
				SELECT
					id_group, group_name, description, online_color, min_posts,
					max_messages, stars, group_type, hidden, id_parent
				FROM {$from_prefix}membergroups;
		</query>
	</step>
	<step>
		<title>Importing permission profiles</title>
		<detect>{$from_prefix}permission_profiles</detect>
		<destination>{$to_prefix}permission_profiles</destination>
		<options>
			<replace>true</replace>
		</options>
		<query>
				SELECT
					id_profile, profile_name
				FROM {$from_prefix}permission_profiles;
		</query>
	</step>
	<step>
		<title>Importing permissions</title>
		<detect>{$from_prefix}permissions</detect>
		<destination>{$to_prefix}permissions</destination>
		<options>
			<replace>true</replace>
		</options>
		<query>
				SELECT
					id_group, permission, add_deny
				FROM {$from_prefix}permissions;
		</query>
	</step>
	<step>
		<title>Importing board permissions</title>
		<detect>{$from_prefix}board_permissions</detect>
		<destination>{$to_prefix}board_permissions</destination>
		<options>
			<replace>true</replace>
		</options>
		<query>
				SELECT
					id_group, id_profile, permission, add_deny
				FROM {$from_prefix}board_permissions;
		</query>
	</step>
	<step>
		<title>Importing smileys</title>
		<detect>{$from_prefix}smileys</detect>
		<destination>{$to_prefix}smileys</destination>
		<options>
			<replace>true</replace>
		</options>
		<query>
				SELECT
					id_smiley, code, filename, description, smiley_row,
					smiley_order, hidden
				FROM {$from_prefix}smileys;
		</query>
	</step>
</importer>